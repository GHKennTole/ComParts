{% extends "baseadmin.html" %}

{% block title %}Lista de Usuarios{% endblock title %}

{% block body %}
<style>
  :root{
    --azul-oscuro:#113155;
    --azul:#1d4ed8;
    --azul-suave:#eef5ff;
  }

  /* Fondo igual a admin/index */
  body{
    background: linear-gradient(180deg, #cfe3ff 0%, #cfe3ff 65%, #cfe3ff 100%) !important;
  }

  /* Encabezado igual al index/admin */
  .section-bar{
    background: linear-gradient(92deg, var(--azul-oscuro), var(--azul));
    color:#fff;
    border-radius:14px;
    box-shadow:0 10px 22px rgba(17,49,85,.25);
  }

  /* Contenedor de tabla tipo card */
  .table-card{
    border-radius:16px;
    background:#fff;
    box-shadow:0 12px 24px rgba(17,49,85,.12);
    padding:18px;
  }

  /* Botones en azul (sin cambiar tu HTML) */
  .btn.btn-success{ background-color: var(--azul); border-color: var(--azul); }
  .btn.btn-success:hover{ background-color: var(--azul-oscuro); border-color: var(--azul-oscuro); }
  .btn.btn-outline-danger{ background-color: #dc3545; border-color: #dc3545; color: #eef5ff; }
  .btn.btn-outline-danger:hover{ background-color: #a71d2a; border-color: #a71d2a; }

  /* Encabezado del modal (sobreescribe bg-success a azul) */
  .modal-header.bg-success{
    background: linear-gradient(92deg, var(--azul-oscuro), var(--azul)) !important;
  }

  /* Cabecera de tabla un poco más marcada */
  thead th{
    background: #f3f7ff;
    color:#113155;
    border-bottom: 2px solid rgba(17,49,85,.08) !important;
  }
</style>

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class="flashes">
  {% for category, message in messages %}
  <script type="text/javascript">
    const Toast = Swal.mixin({
      toast: true,
      position: "top-end",
      showConfirmButton: false,
      timer: 2000,
      timerProgressBar: true,
      didOpen: (toast) => {
        toast.onmouseenter = Swal.stopTimer;
        toast.onmouseleave = Swal.resumeTimer;
      }
    });
    Toast.fire({ icon: "success", title: "{{message}}" });
  </script>
  {% endfor %}
</ul>
{% endif %}
{% endwith %}

<script>
  function confirmarEliminacion(url) {
    // Compatibilidad si no usas data-confirm
    Swal.fire({
      title: '¿Estás seguro?',
      text: "¡No podrás revertir esto!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'Sí, eliminar',
      cancelButtonText: 'Cancelar'
    }).then((result) => { if (result.isConfirmed) window.location.href = url; });
  }
  function toggleForm() {
    const form = document.getElementById('formAgregar');
    form.classList.toggle('d-none');
  }
</script>

<div class="container py-5">
  <!-- Encabezado -->
  <div class="p-4 text-center section-bar mb-4">
    <h1 class="m-0">LISTA DE USUARIOS</h1>
  </div>

  <!-- Acciones -->
  <div class="d-flex justify-content-end mb-3">
    <button class="btn btn-success" onclick="toggleForm()">Agregar Usuario</button>
  </div>

  <!-- Formulario agregar -->
  <div id="formAgregar" class="card p-3 mt-3 d-none" style="border:0; border-radius:16px; box-shadow:0 12px 24px rgba(17,49,85,.12);">
    <form method="POST" action="{{ url_for('agregar_usuario') }}">
      <div class="row g-2">
        <div class="col-md-3">
          <input type="text" name="nombre" class="form-control" placeholder="Nombre" required>
        </div>
        <div class="col-md-3">
          <input type="email" name="email" class="form-control" placeholder="Correo" required>
        </div>
        <div class="col-md-3">
          <input type="text" name="password" class="form-control" placeholder="Contraseña" required>
        </div>
        <div class="col-md-3 d-flex gap-2">
          <button type="submit" class="btn btn-success flex-fill">Guardar</button>
          <button type="button" class="btn btn-secondary flex-fill" onclick="toggleForm()">Cancelar</button>
        </div>
      </div>
    </form>
  </div>

  <!-- Tabla -->
  <div class="table-card mt-4">
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle text-center">
        <thead>
          <tr>
            <th scope="col">N°</th>
            <th scope="col">Nombre</th>
            <th scope="col">Correo</th>
            <th scope="col">Password</th>
            <th scope="col">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for usuario in usuarios %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ usuario.nombre }}</td>
            <td>{{ usuario.email }}</td>
            <td>••••••••</td>
            <td>
              <div class="btn-group btn-group-sm" role="group">
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalEditar{{ usuario.id }}">Editar</button>
                <a href="{{ url_for('eliminar_usuario', id=usuario.id) }}"
                   class="btn btn-outline-danger"
                   data-confirm="¿Está seguro que desea eliminar este usuario?"
                   data-confirm-ok="Sí, eliminar"
                   data-confirm-cancel="Cancelar">
                  Eliminar
                </a>
              </div>
            </td>
          </tr>

          <!-- Modal de Edición -->
          <div class="modal fade" id="modalEditar{{ usuario.id }}" tabindex="-1" aria-labelledby="modalLabel{{ usuario.id }}" aria-hidden="true">
            <div class="modal-dialog">
              <form method="POST" action="{{ url_for('editar_usuario_modal', id=usuario.id) }}">
                <div class="modal-content">
                  <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="modalLabel{{ usuario.id }}">Editar Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-3">
                      <label>Nombre</label>
                      <input type="text" name="nombre" class="form-control" value="{{ usuario.nombre }}" required>
                    </div>
                    <div class="mb-3">
                      <label>Correo</label>
                      <input type="email" name="email" class="form-control" value="{{ usuario.email }}" required>
                    </div>
                    <div class="mb-3">
                      <label>Contraseña</label>
                      <input type="text" name="password" class="form-control" value="{{ usuario.password }}" required>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Guardar Cambios</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}