{% extends "baseadmin.html" %}

{% block title %}Lista de Productos{% endblock title %}

{% block body %}
<style>
  :root{
    --azul-oscuro:#113155;
    --azul:#1d4ed8;
    --azul-suave:#eef5ff;
  }
  body{ background: linear-gradient(180deg, #cfe3ff 0%, #cfe3ff 65%, #cfe3ff 100%) !important; }
  .section-bar{
    background: linear-gradient(92deg, var(--azul-oscuro), var(--azul));
    color:#fff; border-radius:14px; box-shadow:0 10px 22px rgba(17,49,85,.25);
  }
  .panel-card{
    border-radius:16px; background:#fff; box-shadow:0 12px 24px rgba(17,49,85,.12);
    padding:18px; border:0;
  }
  .btn.btn-primary{ background-color: var(--azul); border-color: var(--azul); }
  .btn.btn-primary:hover{ background-color: var(--azul-oscuro); border-color: var(--azul-oscuro); }
  thead th{ background:#f3f7ff; color:#113155; border-bottom:2px solid rgba(17,49,85,.08) !important; }
  .form-control:focus, .form-select:focus, textarea.form-control:focus{
    border-color: var(--azul); box-shadow: 0 0 0 .2rem rgba(29,78,216,.12);
  }
  .panel-card.h-100 { height: auto !important; }
</style>

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class=flashes>
  {% for category, message in messages %}
  <script type="text/javascript">
    const Toast = Swal.mixin({ toast:true, position:"top-end", showConfirmButton:false, timer:2000, timerProgressBar:true,
      didOpen:(t)=>{ t.onmouseenter=Swal.stopTimer; t.onmouseleave=Swal.resumeTimer; }});
    Toast.fire({ icon:"success", title:"{{message}}" });
  </script>
  {% endfor %}
</ul>
{% endif %}
{% endwith %}

<div class="container py-5">
  <div class="p-4 text-center section-bar mb-4">
    <h1 class="m-0">LISTA DE PRODUCTOS</h1>
  </div>

  <div class="row g-4">
    <!-- Formulario para agregar producto -->
    <div class="col-md-4">
      <div class="panel-card">
        <h5 class="fw-bold mb-3 text-center">Agregar Producto</h5>
        <form method="POST" action="{{ url_for('agregar_producto') }}">
          <div class="mb-3">
            <label for="nombre" class="form-label">Nombre del Producto</label>
            <input type="text" class="form-control" name="nombre" required>
          </div>
          <div class="mb-3">
            <label for="precio" class="form-label">Precio</label>
            <input type="number" step="0.01" class="form-control" name="precio" required>
          </div>
          <div class="mb-3">
            <label for="fecha" class="form-label">Fecha</label>
            <input type="date" class="form-control" name="fecha">
          </div>
          <div class="mb-3">
            <label for="descripcion" class="form-label">Descripción</label>
            <textarea class="form-control" name="descripcion" rows="3"></textarea>
          </div>
          <button type="submit" class="btn btn-primary w-100">Agregar Producto</button>
        </form>
      </div>
    </div>

    <!-- Tabla de productos -->
    <div class="col-md-8">
      <div class="panel-card">
        <h5 class="fw-bold mb-3 text-center">Productos</h5>
        <div class="table-responsive">
          <table class="table table-striped table-hover text-center align-middle mb-0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Precio</th>
                <th>Fecha</th>
                <th>Descripción</th>
              </tr>
            </thead>
            <tbody>
              {% for producto in productos %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ producto.nombre }}</td>
                <td>{{ producto.precio | cordoba(0, ',') }}</td>
                <td>
                  {% if producto.fecha %}
                    {{ producto.fecha.strftime('%d-%m-%y') if producto.fecha.strftime is not undefined else producto.fecha }}
                  {% else %}-{% endif %}
                </td>
                <td>{{ producto.descripcion }}</td>
              </tr>
              {% endfor %}
              {% if not productos %}
              <tr>
                <td colspan="5" class="text-muted">No hay productos registrados.</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}